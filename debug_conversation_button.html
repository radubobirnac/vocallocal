<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Conversation Button Debug Test</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        
        .debug-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .button {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 16px;
            border: 2px solid #667eea;
            background: transparent;
            color: #667eea;
            text-decoration: none;
            border-radius: 8px;
            font-weight: 500;
            transition: all 0.3s ease;
            cursor: pointer;
            font-size: 14px;
        }
        
        .button:hover {
            background: #667eea;
            color: white;
            transform: translateY(-1px);
        }
        
        .button-outline {
            border: 2px solid #667eea;
            background: transparent;
            color: #667eea;
        }
        
        .button-icon {
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .conversation-header-btn {
            margin: 10px;
        }
        
        .debug-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background: #f9f9f9;
        }
        
        .debug-output {
            background: #000;
            color: #0f0;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            min-height: 100px;
            overflow-y: auto;
            margin: 10px 0;
        }
        
        .test-button {
            background: #28a745;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        
        .test-button:hover {
            background: #218838;
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-pass { background: #28a745; }
        .status-fail { background: #dc3545; }
        .status-warn { background: #ffc107; }
    </style>
</head>
<body>
    <div class="debug-container">
        <h1>üîß Conversation Button Debug Test</h1>
        
        <div class="debug-section">
            <h3>Original Button (Copy from VocalLocal)</h3>
            <button id="conversation-button" class="button button-outline button-icon conversation-header-btn" title="Start Conversation">
                <i class="fas fa-comments"></i>
                <span class="conversation-text">Chat</span>
            </button>
        </div>
        
        <div class="debug-section">
            <h3>Test Controls</h3>
            <button class="test-button" onclick="runAllTests()">üß™ Run All Tests</button>
            <button class="test-button" onclick="testButtonClick()">üëÜ Test Button Click</button>
            <button class="test-button" onclick="testManualModal()">üîß Test Manual Modal</button>
            <button class="test-button" onclick="testVocalLocalScenario()">üéØ Test VocalLocal Scenario</button>
            <button class="test-button" onclick="clearOutput()">üóëÔ∏è Clear Output</button>
        </div>
        
        <div class="debug-section">
            <h3>Test Results</h3>
            <div id="test-results"></div>
        </div>
        
        <div class="debug-section">
            <h3>Debug Console Output</h3>
            <div id="debug-output" class="debug-output"></div>
        </div>
        
        <!-- Mock Modal for Testing -->
        <div id="conversation-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 10000; justify-content: center; align-items: center;">
            <div style="background: white; padding: 20px; border-radius: 10px; max-width: 400px;">
                <h3>üéâ Conversation Modal Opened!</h3>
                <p>This confirms the button click functionality is working.</p>
                <button onclick="closeConversationModal()" style="background: #dc3545; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer;">Close Modal</button>
            </div>
        </div>
    </div>

    <script>
        // Mock the conversation modal functionality
        let conversationModalInitialized = false;
        
        function log(message, type = 'info') {
            const output = document.getElementById('debug-output');
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? '#ff6b6b' : type === 'success' ? '#51cf66' : type === 'warn' ? '#ffd43b' : '#0f0';
            output.innerHTML += `<div style="color: ${color}">[${timestamp}] ${message}</div>`;
            output.scrollTop = output.scrollHeight;
            console.log(`[${timestamp}] ${message}`);
        }
        
        function addTestResult(test, status, message) {
            const results = document.getElementById('test-results');
            const statusClass = status === 'pass' ? 'status-pass' : status === 'fail' ? 'status-fail' : 'status-warn';
            results.innerHTML += `<div><span class="status-indicator ${statusClass}"></span><strong>${test}:</strong> ${message}</div>`;
        }
        
        function clearOutput() {
            document.getElementById('debug-output').innerHTML = '';
            document.getElementById('test-results').innerHTML = '';
        }
        
        function openConversationModal(userInitiated = false) {
            log(`Opening conversation modal - user initiated: ${userInitiated}`, 'info');
            
            if (!conversationModalInitialized && !userInitiated) {
                log('Conversation modal not initialized - preventing opening', 'warn');
                return;
            }
            
            const modal = document.getElementById('conversation-modal');
            if (modal) {
                modal.style.display = 'flex';
                log('Conversation modal opened successfully', 'success');
            } else {
                log('Conversation modal element not found', 'error');
            }
        }
        
        function closeConversationModal() {
            const modal = document.getElementById('conversation-modal');
            if (modal) {
                modal.style.display = 'none';
                log('Conversation modal closed', 'info');
            }
        }
        
        function testElementExists() {
            log('Testing if conversation button element exists...', 'info');
            const button = document.getElementById('conversation-button');
            if (button) {
                log('‚úÖ Conversation button element found', 'success');
                addTestResult('Element Exists', 'pass', 'Button element found in DOM');
                return true;
            } else {
                log('‚ùå Conversation button element NOT found', 'error');
                addTestResult('Element Exists', 'fail', 'Button element not found in DOM');
                return false;
            }
        }
        
        function testButtonProperties() {
            log('Testing button properties...', 'info');
            const button = document.getElementById('conversation-button');
            if (!button) return false;
            
            const computedStyle = window.getComputedStyle(button);
            const rect = button.getBoundingClientRect();
            
            log(`Button display: ${computedStyle.display}`, 'info');
            log(`Button visibility: ${computedStyle.visibility}`, 'info');
            log(`Button pointer-events: ${computedStyle.pointerEvents}`, 'info');
            log(`Button position: ${rect.left}, ${rect.top}, ${rect.width}x${rect.height}`, 'info');
            
            const isVisible = rect.width > 0 && rect.height > 0;
            const isClickable = computedStyle.pointerEvents !== 'none';
            
            if (isVisible && isClickable) {
                log('‚úÖ Button is visible and clickable', 'success');
                addTestResult('Button Properties', 'pass', 'Button is visible and clickable');
                return true;
            } else {
                log('‚ùå Button has visibility or clickability issues', 'error');
                addTestResult('Button Properties', 'fail', `Visible: ${isVisible}, Clickable: ${isClickable}`);
                return false;
            }
        }
        
        function testEventListeners() {
            log('Testing event listeners...', 'info');
            const button = document.getElementById('conversation-button');
            if (!button) return false;
            
            // Check if getEventListeners is available (Chrome DevTools)
            if (typeof getEventListeners === 'function') {
                const listeners = getEventListeners(button);
                log(`Event listeners found: ${JSON.stringify(Object.keys(listeners))}`, 'info');
                
                if (listeners.click && listeners.click.length > 0) {
                    log('‚úÖ Click event listener found', 'success');
                    addTestResult('Event Listeners', 'pass', `${listeners.click.length} click listener(s) found`);
                    return true;
                } else {
                    log('‚ùå No click event listener found', 'error');
                    addTestResult('Event Listeners', 'fail', 'No click event listeners found');
                    return false;
                }
            } else {
                log('‚ö†Ô∏è getEventListeners not available (not in Chrome DevTools)', 'warn');
                addTestResult('Event Listeners', 'warn', 'Cannot check listeners (getEventListeners not available)');
                return null;
            }
        }
        
        function testButtonClick() {
            log('Testing button click functionality...', 'info');
            const button = document.getElementById('conversation-button');
            if (!button) return false;
            
            // Add a test click listener
            let clickDetected = false;
            const testListener = function() {
                clickDetected = true;
                log('‚úÖ Button click detected!', 'success');
            };
            
            button.addEventListener('click', testListener);
            
            // Simulate click
            log('Simulating button click...', 'info');
            button.click();
            
            // Remove test listener
            button.removeEventListener('click', testListener);
            
            if (clickDetected) {
                addTestResult('Button Click', 'pass', 'Button click event fired successfully');
                return true;
            } else {
                log('‚ùå Button click not detected', 'error');
                addTestResult('Button Click', 'fail', 'Button click event did not fire');
                return false;
            }
        }
        
        function testManualModal() {
            log('Testing manual modal opening...', 'info');
            conversationModalInitialized = true;
            openConversationModal(true);
        }

        function testVocalLocalScenario() {
            log('üéØ Testing VocalLocal-specific scenario...', 'info');

            // Simulate the exact VocalLocal environment
            log('Simulating VocalLocal conversation-modal.js behavior...', 'info');

            // Check if the button exists
            const button = document.getElementById('conversation-button');
            if (!button) {
                log('‚ùå Button not found - this is the main issue!', 'error');
                addTestResult('VocalLocal Scenario', 'fail', 'Conversation button element not found');
                return false;
            }

            // Simulate the exact event listener setup from conversation-modal.js
            log('Setting up VocalLocal-style event listener...', 'info');

            let vocalLocalClickDetected = false;
            const vocalLocalListener = function(event) {
                log('üéâ VocalLocal-style click detected!', 'success');
                vocalLocalClickDetected = true;

                // Simulate the exact VocalLocal behavior
                console.log('Conversation button clicked by user');
                event.preventDefault();
                event.stopPropagation();

                // Try to call openConversationModal like VocalLocal does
                if (typeof openConversationModal === 'function') {
                    log('Calling openConversationModal(true)...', 'info');
                    openConversationModal(true);
                } else {
                    log('openConversationModal function not available', 'warn');
                }
            };

            // Add the listener
            button.addEventListener('click', vocalLocalListener);

            // Test the click
            log('Triggering VocalLocal-style click...', 'info');
            button.click();

            // Clean up
            button.removeEventListener('click', vocalLocalListener);

            if (vocalLocalClickDetected) {
                log('‚úÖ VocalLocal scenario test PASSED!', 'success');
                addTestResult('VocalLocal Scenario', 'pass', 'Button works exactly like in VocalLocal');
                return true;
            } else {
                log('‚ùå VocalLocal scenario test FAILED!', 'error');
                addTestResult('VocalLocal Scenario', 'fail', 'Button does not work like in VocalLocal');
                return false;
            }
        }
        
        function runAllTests() {
            log('üß™ Starting comprehensive button tests...', 'info');
            clearOutput();

            setTimeout(() => {
                const test1 = testElementExists();
                setTimeout(() => {
                    const test2 = testButtonProperties();
                    setTimeout(() => {
                        const test3 = testEventListeners();
                        setTimeout(() => {
                            const test4 = testButtonClick();
                            setTimeout(() => {
                                const test5 = testRealWorldScenario();

                                log('üèÅ All tests completed!', 'info');

                                const passedTests = [test1, test2, test4, test5].filter(t => t === true).length;
                                const totalTests = 4 + (test3 !== null ? 1 : 0);

                                if (passedTests === totalTests) {
                                    log('üéâ All tests PASSED! Button should be working.', 'success');
                                } else {
                                    log(`‚ö†Ô∏è ${passedTests}/${totalTests} tests passed. Check failed tests above.`, 'warn');
                                }
                            }, 500);
                        }, 500);
                    }, 500);
                }, 500);
            }, 100);
        }

        function testRealWorldScenario() {
            log('Testing real-world button click scenario...', 'info');
            const button = document.getElementById('conversation-button');
            if (!button) return false;

            // Test if button responds to actual user interaction
            let realClickDetected = false;

            // Create a more realistic click event
            const clickEvent = new MouseEvent('click', {
                bubbles: true,
                cancelable: true,
                view: window
            });

            const realListener = function(e) {
                realClickDetected = true;
                log('‚úÖ Real-world click event detected!', 'success');
                log(`Event details: type=${e.type}, bubbles=${e.bubbles}, target=${e.target.tagName}`, 'info');
            };

            button.addEventListener('click', realListener);

            // Dispatch the event
            log('Dispatching realistic click event...', 'info');
            button.dispatchEvent(clickEvent);

            // Clean up
            button.removeEventListener('click', realListener);

            if (realClickDetected) {
                addTestResult('Real-World Click', 'pass', 'Button responds to realistic click events');
                return true;
            } else {
                log('‚ùå Real-world click not detected', 'error');
                addTestResult('Real-World Click', 'fail', 'Button does not respond to realistic click events');
                return false;
            }
        }
        
        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            log('üöÄ Debug page loaded - setting up conversation button test', 'info');
            
            // Add click listener to the conversation button
            const conversationButton = document.getElementById('conversation-button');
            if (conversationButton) {
                log('Conversation button found - adding click listener', 'info');
                conversationButton.addEventListener('click', function(event) {
                    log('Conversation button clicked by user', 'success');
                    event.preventDefault();
                    event.stopPropagation();
                    openConversationModal(true);
                });
            } else {
                log('Conversation button not found on this page', 'error');
            }
            
            // Mark as initialized
            setTimeout(() => {
                conversationModalInitialized = true;
                log('Conversation modal fully initialized', 'info');
            }, 100);
        });
    </script>
</body>
</html>
